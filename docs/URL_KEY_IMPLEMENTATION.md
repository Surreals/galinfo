# Реалізація URL ключів для новин

## Проблема

В базі даних є поле `url_key`, яке використовується для навігації до новин через URL типу `/news/{url_key}_{id}`. Проте після створення новин в новому проекті це поле відсутнє або порожнє, що унеможливлює навігацію.

## Рішення

### 1. Створено утиліту транслітерації

**Файл:** `app/lib/transliteration.ts`

Реалізовано функції:
- `transliterate()` - транслітерація українських символів в латиницю
- `generateUrlKey()` - генерація безпечного URL ключа з заголовка новини

Логіка базується на функціях `TranslitAll()` та `safeUrlStr()` з `deprecated_php_app/lib/etc/utfstuff.php`.

### 2. Оновлено редактор новин

**Файл:** `app/admin/components/NewsEditor.tsx`

- Замінено просту функцію `generateUrlKey()` на використання правильної транслітерації
- Автоматична генерація `url_key` при зміні заголовка новини
- Автоматична генерація `url_key` при збереженні, якщо поле порожнє

### 3. Оновлено API збереження новин

**Файл:** `app/api/admin/news/save/route.ts`

- Додано автоматичну генерацію `url_key` якщо поле не надано або порожнє
- Використовується функція `generateUrlKey()` з утиліти транслітерації

### 4. Оновлено бібліотеку новин

**Файл:** `app/lib/news.ts`

- Додано автоматичну генерацію `url_key` при створенні новин через функцію `createNews()`

### 5. Створено скрипт оновлення існуючих новин

**Файл:** `scripts/update-url-keys.js`

Скрипт для оновлення `url_key` для існуючих новин, які не мають цього поля:
- Знаходить новини без `url_key` або з порожнім `url_key`
- Генерує `url_key` на основі заголовка новини
- Оновлює записи в базі даних

**Запуск:**
```bash
node scripts/update-url-keys.js
```

### 6. Створено API endpoint для оновлення

**Файл:** `app/api/admin/news/update-url-keys/route.ts`

API endpoint для оновлення `url_key` через адмін панель:
- `POST /api/admin/news/update-url-keys`
- Повертає статистику оновлених записів

### 7. Додано кнопку в адмін панель

**Файли:** `app/admin/news/page.tsx`, `app/admin/news/news.module.css`

- Додано кнопку "Оновити URL ключі" в адмін панелі новин
- Кнопка запускає API endpoint для оновлення всіх новин без `url_key`
- Показує прогрес та результат операції

## Результат

✅ **Автоматична генерація:** При створенні нових новин `url_key` генерується автоматично

✅ **Оновлення існуючих:** Створено інструменти для оновлення існуючих новин

✅ **Правильна транслітерація:** Українські символи правильно транслітеруються в латиницю

✅ **Сумісність:** Логіка відповідає старому PHP додатку

## Приклад роботи

**Заголовок:** "У Львові обговорили тему викрадення українських дітей росією"
**URL ключ:** "u_lvovi_obgovoryly_temu_vykradennya_ukrainskyh_ditey_rosiieyu"
**URL:** `/news/u_lvovi_obgovoryly_temu_vykradennya_ukrainskyh_ditey_rosiieyu_427154`

## Використання

### Для нових новин
URL ключ генерується автоматично при створенні або редагуванні новини.

### Для існуючих новин
1. Через адмін панель: натиснути кнопку "Оновити URL ключі"
2. Через командний рядок: `node scripts/update-url-keys.js`

### Ручна генерація
```typescript
import { generateUrlKey } from '@/app/lib/transliteration';

const urlKey = generateUrlKey('Заголовок новини');
// Результат: "zagolovok_novyny"
```
