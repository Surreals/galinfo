# Article Editor Data Loading - Implementation Summary

## Огляд змін

Реалізовано автоматичне завантаження та відображення даних новини в полях форми при відкритті сторінки редагування.

## Основні зміни

### 1. Оновлено компонент NewsEditorSidebar

**Файл:** `app/admin/article-editor/components/NewsEditorSidebar.tsx`

**Додані функції:**
- `useEffect` хук для автоматичного оновлення всіх полів при зміні `articleData`
- Ініціалізація стану з даних новини
- Скидання до значень за замовчуванням при створенні нової новини
- Обробка зображень з даних новини

**Поля, які автоматично заповнюються:**
- Тип статті (`ntype`)
- Рубрики (`rubric`) - множинний вибір
- Регіони (`region`) - множинний вибір  
- Тема (`theme`)
- Теги (`tags`)
- Редактор (`nauthor`)
- Автор/журналіст (`userid`)
- Показувати автора (`showauthor`)
- Пріоритет (`nweight`)
- Шаблон (`layout`)
- Всі додаткові параметри (чекбокси)
- Час публікації (`ndate`, `ntime`)
- Прапори публікації (`approved`, `to_twitter`)
- Зображення (`images`)

### 2. Оновлено компонент NewsEditorHeader

**Файл:** `app/admin/article-editor/components/NewsEditorHeader.tsx`

**Додані функції:**
- `useEffect` хук для оновлення полів заголовків
- Автоматичне заповнення полів з даних новини
- Скидання полів при створенні нової новини

**Поля, які автоматично заповнюються:**
- Заголовок (`nheader`)
- Лід (`nteaser`)
- Спеціальний заголовок (`sheader`)
- Meta title (`ntitle`)
- Meta description (`ndescription`)
- Meta keywords (`nkeywords`)

### 3. Створено хук useArticleSave

**Файл:** `app/hooks/useArticleSave.ts`

**Функціональність:**
- Збереження новини (створення/оновлення)
- Видалення новини
- Обробка стану завантаження
- Показ повідомлень про успіх/помилки

**API виклики:**
- `POST /api/admin/articles` - створення нової новини
- `PUT /api/admin/articles/[id]` - оновлення існуючої новини
- `DELETE /api/admin/articles/[id]` - видалення новини

### 4. Створено компонент ArticleEditorLoader

**Файл:** `app/admin/article-editor/components/ArticleEditorLoader.tsx`

**Функціональність:**
- Відображення індикатора завантаження
- Показ помилок з можливістю повторного завантаження
- Обгортання основного контенту

### 5. Оновлено головний компонент ArticleEditor

**Файл:** `app/admin/article-editor/page.tsx`

**Зміни:**
- Додано `Suspense` для обробки асинхронного завантаження
- Інтеграція з `ArticleEditorLoader`
- Передача даних новини в дочірні компоненти

### 6. Створено API ендпоінт для створення новин

**Файл:** `app/api/admin/articles/route.ts`

**Функціональність:**
- `POST` - створення нової новини
- Валідація даних
- Повернення створеної новини з ID

## Логіка роботи

### При відкритті нової новини (без ID):
1. `useArticleData` повертає `defaultArticleData`
2. Компоненти ініціалізуються з порожніми полями
3. Користувач може заповнити форму

### При відкритті існуючої новини (з ID):
1. `useArticleData` завантажує дані з API
2. Показується індикатор завантаження
3. При успішному завантаженні:
   - `useEffect` в `NewsEditorSidebar` оновлює всі поля
   - `useEffect` в `NewsEditorHeader` оновлює поля заголовків
   - Форма заповнюється даними новини
4. При помилці показується повідомлення про помилку

### При збереженні:
1. `useArticleSave` збирає дані з форми
2. Відправляє запит на відповідний API ендпоінт
3. Показує повідомлення про успіх/помилку
4. Оновлює стан завантаження кнопок

## Особливості реалізації

### Обробка зображень
```typescript
// Конвертація рядка зображень в UploadFile[]
if (articleData.images) {
  const imageFiles = articleData.images.split(',').map((filename, index) => ({
    uid: `image-${index}`,
    name: filename.trim(),
    status: 'done' as const,
    url: `/media/gallery/tmb/${filename.trim()}`,
  }));
  setFileList(imageFiles);
}
```

### Обробка тегів
```typescript
// Конвертація масиву тегів в рядок для відображення
setTags(articleData.tags.join(', '));

// Конвертація рядка тегів в масив для збереження
tags: tags.split(',').map(tag => tag.trim()).filter(tag => tag)
```

### Обробка дати та часу
```typescript
// Парсинг дати та часу з даних новини
setPublishAt(dayjs(`${articleData.ndate} ${articleData.ntime}`));

// Форматування для збереження
ndate: publishAt?.format('YYYY-MM-DD'),
ntime: publishAt?.format('HH:mm:ss'),
```

## Стани інтерфейсу

### Завантаження
- Показується `ArticleEditorLoader` з індикатором
- Кнопки збереження/видалення неактивні

### Помилка
- Показується `ArticleEditorLoader` з повідомленням про помилку
- Кнопка "Спробувати знову" для повторного завантаження

### Успішне завантаження
- Відображається повна форма з заповненими полями
- Всі функції доступні

### Збереження
- Кнопки показують індикатор завантаження
- Кнопки неактивні під час збереження

## Тестування

### Сценарії тестування:

1. **Створення нової новини:**
   - Відкрити `/admin/article-editor`
   - Перевірити, що всі поля порожні
   - Заповнити форму та зберегти

2. **Редагування існуючої новини:**
   - Відкрити `/admin/article-editor?id=1`
   - Перевірити, що всі поля заповнені даними
   - Змінити дані та зберегти

3. **Обробка помилок:**
   - Симулювати помилку API
   - Перевірити відображення повідомлення про помилку

4. **Збереження:**
   - Перевірити індикатори завантаження
   - Перевірити повідомлення про успіх/помилку

## Висновок

Реалізовано повну функціональність автоматичного завантаження та відображення даних новини в формі редагування. Система працює як для створення нових новин, так і для редагування існуючих, з правильною обробкою всіх станів інтерфейсу.
