# Оновлення системи управління користувачами

## Огляд змін

Система управління користувачами була оновлена відповідно до нових вимог:

### 1. Розділення на таби (Активні/Неактивні користувачі)

**Файл:** `app/admin/users/page.tsx`

- Додано таби для розділення активних та неактивних користувачів
- Кожен таб показує відповідну кількість користувачів
- Пошук працює в межах поточного табу

**Зміни:**
- Додано імпорт `Tabs` та іконки `UserOutlined`, `UserDeleteOutlined`
- Додано стан `activeTab` для відстеження поточного табу
- Оновлено фільтрацію користувачів для роботи з табами
- Замінено таблицю на компонент `Tabs` з двома вкладками

### 2. Заміна видалення на деактивацію

**Файли:**
- `app/admin/users/page.tsx`
- `app/api/admin/users/[id]/deactivate/route.ts`
- `app/api/admin/users/[id]/activate/route.ts`

**Зміни:**
- Замінено кнопку "Видалити" на "Деактивувати" для активних користувачів
- Додано кнопку "Активувати" для неактивних користувачів
- При деактивації користувач втрачає всі права доступу (`perm = '{}'`)
- При активації права доступу відновлюються відповідно до ролі

### 3. Автоматичне розлогінювання після деактивації

**Файли:**
- `app/contexts/AdminAuthContext.tsx`
- `app/api/admin/login/route.ts`

**Зміни:**
- Система аутентифікації перевіряє активний статус користувача при вході
- Додано перевірку статусу користувача в `AdminAuthContext`
- Неактивні користувачі автоматично розлогінюються при спробі доступу

### 4. Приховування неактивних користувачів при створенні новин

**Файл:** `app/api/admin/all-users/route.ts`

**Зміни:**
- API ендпоінт `/api/admin/all-users` показує тільки активних користувачів
- Неактивні користувачі не відображаються в списку авторів при створенні новин
- Залишаються доступними в адмін-панелі для управління

## API Ендпоінти

### Нові ендпоінти:

1. **POST `/api/admin/users/[id]/deactivate`**
   - Деактивує користувача
   - Видаляє всі права доступу
   - Логує дію розлогінювання

2. **POST `/api/admin/users/[id]/activate`**
   - Активує користувача
   - Відновлює права доступу відповідно до ролі
   - Логує дію активації

3. **POST `/api/admin/users/[id]/logout`**
   - Примусово розлогінює користувача
   - Використовується для розлогінювання після деактивації

### Оновлені ендпоінти:

1. **DELETE `/api/admin/users/[id]`**
   - Тепер повертає помилку 405 (Method Not Allowed)
   - Направляє на використання ендпоінту деактивації

2. **GET `/api/admin/all-users`**
   - Показує тільки активних користувачів
   - Використовується для вибору авторів при створенні новин

## Безпека

- Неактивні користувачі не можуть увійти в систему
- При деактивації користувач втрачає доступ до всіх функцій
- Автоматична перевірка статусу користувача при кожному доступі
- Логування всіх дій активації/деактивації

## Інтерфейс користувача

### Сторінка `/admin/users`:

1. **Таб "Активні"**
   - Показує всіх активних користувачів
   - Кнопка "Деактивувати" для кожного користувача
   - Підтвердження з попередженням про розлогінювання

2. **Таб "Неактивні"**
   - Показує всіх неактивних користувачів
   - Кнопка "Активувати" для кожного користувача
   - Відновлення прав доступу при активації

### Створення новин:

- У списку авторів відображаються тільки активні користувачі
- Неактивні користувачі недоступні для вибору як автори

## Технічні деталі

### База даних:
- Поле `active` в таблиці `a_powerusers` використовується для контролю статусу
- Поле `perm` очищається при деактивації та відновлюється при активації

### Фронтенд:
- Використовується Ant Design для UI компонентів
- Реактивне оновлення списку користувачів після змін
- Автоматична перевірка статусу користувача в контексті

### Безпека сесій:
- Перевірка статусу при кожному завантаженні додатку
- Автоматичне розлогінювання неактивних користувачів
- Захист від доступу неактивних користувачів до API
